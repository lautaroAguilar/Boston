(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[748],{89159:(e,a,t)=>{Promise.resolve().then(t.bind(t,26971))},26971:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>b});var l=t(95155),n=t(12115),r=t(55295),i=t(92608),s=t(78562),o=t(9561),d=t(22282);let u=(0,t(22471).A)((0,l.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V8c0-.55-.45-1-1-1s-1 .45-1 1v2H2c-.55 0-1 .45-1 1s.45 1 1 1h2v2c0 .55.45 1 1 1s1-.45 1-1v-2h2c.55 0 1-.45 1-1s-.45-1-1-1zm9 4c-2.67 0-8 1.34-8 4v1c0 .55.45 1 1 1h14c.55 0 1-.45 1-1v-1c0-2.66-5.33-4-8-4"}),"PersonAddRounded");var c=t(78039),m=t(11896),h=t(93717),f=t(64527),p=t(32371),x=t(44026),v=t(72971),g=t(16118);function b(){let e=(0,h.A)(m.F),a=(0,r.A)("(max-width:600px)"),{setSnackbarErrorMessage:t,setToolbarButtonAction:b,setSnackbarMessage:j,snackbarMessage:A,snackbarErrorMessage:y,setOpenSnackbar:w}=(0,v.M)(),{companiesInfo:_}=(0,g.P)(),[C,N]=(0,n.useState)(!1),[E,S]=(0,n.useState)(!1),[q,D]=(0,n.useState)(!1),[P,W]=(0,n.useState)(!1),[R,k]=(0,n.useState)({}),[M,G]=(0,n.useState)({first_name:"",last_name:"",email:"",password:"",role_id:"",belongs_to:""});async function I(){try{let e=await fetch("".concat(x.A.API_URL,"/settings/roles")),a=await e.json();D(a);return}catch(e){console.log(e)}}let T=[{name:"first_name",label:"Nombre",required:!0},{name:"last_name",label:"Apellido",required:!0},{name:"email",label:"Email",type:"email",required:!0},{name:"password",label:"Contrase\xf1a",type:"password",required:!0},{name:"role_id",label:"Rol",type:"select",required:!0,component:"select",options:q?q.map(e=>({id:e.id,label:e.name})):[{id:0,label:"No se encontraron roles"}]},{name:"belongs_to",label:"Pertenece a la empresa",type:"select",component:"select",options:_?null==_?void 0:_.map(e=>({id:e.name,label:e.name})):[{id:0,label:"No se encontraron empresas"}]}];function H(){N(!0)}let O=async()=>{k({});try{let e=await fetch("".concat(x.A.API_URL,"/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(M)});if(!e.ok){let a=await e.json();if(Array.isArray(a)){let e=a.reduce((e,a)=>(e[a.path[0]]=a.message,e),{});k(e)}else t(a.message||"Error desconocido");return}let a=await e.json();j(a.message),W(!0),N(!1);return}catch(e){t(e.message),console.error("Error al registrar: ",e)}},F=async()=>{try{let e=await fetch("".concat(x.A.API_URL,"/user"),{method:"GET",credentials:"include"}),a=await e.json();if(!e.ok){t(a.message);return}S(a);return}catch(e){console.log("error al buscar usuarios",e)}},L=[{field:"id",headerName:"ID",minWidth:50},{field:"first_name",headerName:"Nombre",minWidth:150,flex:1},{field:"last_name",headerName:"Apellido",minWidth:150,flex:1},{field:"email",headerName:"Email",minWidth:200,flex:1},{field:"role_id",headerName:"Rol",minWidth:150,flex:1,renderCell:e=>{let a=q.find(a=>a.id===e.value);return a?a.name:"Desconocido"}},{field:"belongs_to",headerName:"Empresa",minWidth:150,flex:1}];return(0,n.useEffect)(()=>{b({label:"Crear nuevo",action:H,icon:(0,l.jsx)(u,{})})},[b]),(0,n.useEffect)(()=>{(A||y)&&w(!0)},[A,y]),(0,n.useEffect)(()=>{F(),I()},[P]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(f.A,{theme:e,children:(0,l.jsx)(c.z,{columns:L,rows:E,getRowId:e=>e.id,getEstimatedRowHeight:()=>100,getRowHeight:()=>"auto",sx:{width:"100%","&.MuiDataGrid-root--densityCompact .MuiDataGrid-cell":{py:1},"&.MuiDataGrid-root--densityStandard .MuiDataGrid-cell":{py:"15px"},"&.MuiDataGrid-root--densityComfortable .MuiDataGrid-cell":{py:"22px"}}})}),(0,l.jsx)(i.A,{open:C,onClose:()=>{N(!1)},sx:{height:"100%"},children:(0,l.jsxs)(s.A,{elevation:4,square:!1,sx:{height:"90%",width:a?"90%":"50%",display:"flex",flexDirection:"column",p:2,gap:2,maxWidth:500,maxHeight:600,overflowY:"auto",scrollbarWidth:"thin",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[(0,l.jsx)(o.default,{variant:"h4",children:"Crear nuevo usuario"}),(0,l.jsx)(p.A,{fields:T,values:M,errors:R,onChange:(e,a)=>{G(t=>({...t,[e]:a}))}}),(0,l.jsx)(d.A,{variant:"contained",onClick:O,children:"Crear usuario"})]})})]})}},32371:(e,a,t)=>{"use strict";t.d(a,{A:()=>g});var l=t(95155),n=t(12115),r=t(68998),i=t(10979),s=t(22678),o=t(90507),d=t(83774),u=t(91888),c=t(16508),m=t(39905),h=t(22282),f=t(9561),p=t(20719),x=t(31798),v=t(9313);function g(e){let{fields:a,values:t={},onChange:g,errors:b={},successMessage:j,errorMessage:A}=e,[y,w]=(0,n.useState)(!1);return(0,l.jsx)(r.default,{component:"form",sx:{height:"100%",width:"100%",margin:"0 auto",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:(0,l.jsxs)(i.default,{spacing:2,sx:{mt:2},children:[a.map((e,a)=>{var n;return(0,l.jsx)(i.default,{children:(()=>{var a,n,r,i,f,j,A,_;switch(e.component){case"select":return(0,l.jsxs)(s.A,{fullWidth:!0,children:[(0,l.jsx)(o.A,{children:e.label}),(0,l.jsx)(d.A,{name:e.name,label:e.label,value:t[e.name]||"",onChange:a=>g(e.name,a.target.value),required:null!==(n=e.required)&&void 0!==n&&n,children:null===(a=e.options)||void 0===a?void 0:a.map((e,a)=>{var t;return(0,l.jsx)(u.A,{value:e.id,children:e.label},null!==(t=e.id)&&void 0!==t?t:a)})}),b&&b[e.name]&&(0,l.jsx)(c.A,{children:b[e.name]})]});case"date":return(0,l.jsx)(p.l,{label:e.label,value:null!==(r=t[e.name])&&void 0!==r?r:null,defaultValue:"",onChange:a=>g(e.name,a?a.toString():""),slotProps:{textField:{error:!!b[e.name],helperText:null!==(i=b[e.name])&&void 0!==i?i:""}}});default:return(0,l.jsx)(m.A,{fullWidth:!0,type:y?"text":null!==(f=e.type)&&void 0!==f?f:"text",label:e.label,name:e.name,required:null!==(j=e.required)&&void 0!==j&&j,value:null!==(A=t[e.name])&&void 0!==A?A:"",onChange:a=>g(e.name,a.target.value),error:!!b[e.name],helperText:null!==(_=b[e.name])&&void 0!==_?_:"",slotProps:{input:{endAdornment:"password"===e.type&&(0,l.jsx)(h.A,{onClick:()=>w(!y),children:y?(0,l.jsx)(x.A,{}):(0,l.jsx)(v.A,{})})}}})}})()},null!==(n=e.name)&&void 0!==n?n:a)}),(0,l.jsx)(f.default,{children:j}),(0,l.jsx)(f.default,{children:A})]})})}}},e=>{var a=a=>e(e.s=a);e.O(0,[120,735,539,85,724,392,926,675,255,34,118,441,517,358],()=>a(89159)),_N_E=e.O()}]);